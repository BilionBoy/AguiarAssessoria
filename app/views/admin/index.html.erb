<div class="modern-dashboard">
  <!-- Header moderno -->
  <div class="page-header modern-header shadow-sm">
    <div class="page-header-content d-lg-flex">
      <div class="d-flex">
        <div class="breadcrumb modern-breadcrumb py-3">
          <a href="<%= admin_index_path %>" class="breadcrumb-item">
            <i data-lucide="home" style="width: 16px; height: 16px;"></i>
          </a>
          <span class="breadcrumb-item active">Dashboard</span>
        </div>
      </div>
    </div>
  </div>
  <div class="content" style="padding: 32px 24px;">
    <!-- Cards de Estatísticas Modernos -->
    <div class="stats-grid">
      <div class="stat-card primary">
        <div class="stat-icon-value">
          <div class="stat-icon primary">
            <i data-lucide="users" style="width: 24px; height: 24px;"></i>
          </div>
          <div class="stat-value"><%= @clientes %></div>
        </div>
        <div class="stat-label">Total de Clientes</div>
        <div class="stat-badge <%= @crescimento_clientes >= 0 ? 'positive' : 'negative' %>">
          <i data-lucide="<%= @crescimento_clientes >= 0 ? 'trending-up' : 'trending-down' %>" style="width: 12px; height: 12px;"></i>
          <%= @crescimento_clientes >= 0 ? '+' : '' %><%= @crescimento_clientes %>% este mês
        </div>
      </div>
      <div class="stat-card success">
        <div class="stat-icon-value">
          <div class="stat-icon success">
            <i data-lucide="target" style="width: 24px; height: 24px;"></i>
          </div>
          <div class="stat-value"><%= @percentual_metas.to_i %>%</div>
        </div>
        <div class="stat-label">Metas Alcançadas</div>
        <div class="stat-badge <%= @percentual_metas >= 50 ? 'positive' : 'attention' %>">
          <i data-lucide="<%= @percentual_metas >= 50 ? 'check-circle' : 'alert-circle' %>" style="width: 12px; height: 12px;"></i>
          <%= number_to_currency(@realizado_mes, unit: "R$ ", separator: ",", delimiter: ".") %> de <%= number_to_currency(@meta_mes, unit: "R$ ", separator: ",", delimiter: ".") %>
        </div>
      </div>
      <div class="stat-card warning">
        <div class="stat-icon-value">
          <div class="stat-icon warning">
            <i data-lucide="clock" style="width: 24px; height: 24px;"></i>
          </div>
          <div class="stat-value"><%= @contratos_pendentes %></div>
        </div>
        <div class="stat-label">Contratos Pendentes</div>
        <div class="stat-badge <%= @contratos_pendentes > 0 ? 'attention' : 'positive' %>">
          <i data-lucide="<%= @contratos_pendentes > 0 ? 'alert-circle' : 'check-circle' %>" style="width: 12px; height: 12px;"></i>
          <%= @contratos_pendentes > 0 ? 'Requer atenção' : 'Tudo em dia' %>
        </div>
      </div>
      <div class="stat-card accent">
        <div class="stat-icon-value">
          <div class="stat-icon accent">
            <i data-lucide="credit-card" style="width: 24px; height: 24px;"></i>
          </div>
          <div class="stat-value"><%= number_to_currency(@comissoes_mes, unit: "R$ ", separator: ",", delimiter: ".") %></div>
        </div>
        <div class="stat-label">Comissões do Mês</div>
        <div class="stat-badge <%= @crescimento_comissoes >= 0 ? 'positive' : 'negative' %>">
          <i data-lucide="<%= @crescimento_comissoes >= 0 ? 'trending-up' : 'trending-down' %>" style="width: 12px; height: 12px;"></i>
          <%= @crescimento_comissoes >= 0 ? '+' : '' %><%= @crescimento_comissoes %>% este mês
        </div>
      </div>
    </div>
    <!-- Tabela de Contratos Modernizada -->
    <div class="modern-card">
      <div class="modern-card-header d-flex align-items-center justify-content-between">
        <h5 class="modern-card-title">
          <i data-lucide="file-text" style="width: 20px; height: 20px;"></i>
          Contratos Recentes
        </h5>
        <%= link_to new_e_contrato_path, class: "btn btn-primary" do %>
          <i data-lucide="plus" style="width: 16px; height: 16px;"></i>
          Novo Contrato
        <% end %>
      </div>
      <% if @contratos_recentes.any? %>
        <div class="table-responsive">
          <table class="modern-table">
            <thead>
              <tr>
                <th>Cliente</th>
                <th>Valor</th>
                <th>Parcelas</th>
                <th>Status</th>
                <th>Data</th>
                <th style="text-align: center;">Ações</th>
              </tr>
            </thead>
            <tbody>
              <% @contratos_recentes.each do |contrato| %>
                <tr>
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="user-avatar" style="background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);">
                        <%= contrato.e_cliente.nome_completo.split.map(&:first).take(2).join.upcase %>
                      </div>
                      <div>
                        <div style="font-weight: 600; color: var(--neutral-900); margin-bottom: 2px;">
                          <%= contrato.e_cliente.nome_completo %>
                        </div>
                        <div style="color: var(--neutral-500); font-size: 13px;">
                          <%= contrato.e_cliente.email || contrato.e_cliente.cpf %>
                        </div>
                      </div>
                    </div>
                  </td>
                  <td style="font-weight: 600; color: var(--neutral-900);">
                    <%= number_to_currency(contrato.valor_total, unit: "R$ ", separator: ",", delimiter: ".") %>
                  </td>
                  <td style="color: var(--neutral-600);"><%= contrato.quantidade_parcelas %>x</td>
                  <td>
                    <% status_class = case contrato.g_status_contrato.descricao.downcase
                                      when /aprovado|pago/ then 'approved'
                                      when /pendente/ then 'pending'
                                      when /análise|analise/ then 'analysis'
                                      when /cancelado|rejeitado/ then 'rejected'
                                      else 'analysis'
                                      end %>
                    <span class="status-badge <%= status_class %>">
                      <%= contrato.g_status_contrato.descricao %>
                    </span>
                  </td>
                  <td style="color: var(--neutral-600);">
                    <%= l(contrato.data_cadastro, format: :short) %>
                  </td>
                  <td style="text-align: center;">
                    <div class="dropdown">
                      <button type="button" class="action-btn dropdown-toggle" data-bs-toggle="dropdown">
                        <i data-lucide="more-horizontal" style="width: 16px; height: 16px;"></i>
                      </button>
                      <div class="dropdown-menu">
                        <%= link_to e_contrato_path(contrato), class: "dropdown-item" do %>
                          <i data-lucide="eye" style="width: 16px; height: 16px;"></i>
                          Visualizar
                        <% end %>
                        <%= link_to edit_e_contrato_path(contrato), class: "dropdown-item" do %>
                          <i data-lucide="edit" style="width: 16px; height: 16px;"></i>
                          Editar
                        <% end %>
                        <%= link_to e_contrato_path(contrato, format: :pdf), class: "dropdown-item", target: "_blank" do %>
                          <i data-lucide="download" style="width: 16px; height: 16px;"></i>
                          Download
                        <% end %>
                      </div>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div style="padding: 48px 24px; text-align: center;">
          <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: var(--neutral-100); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <i data-lucide="file-text" style="width: 32px; height: 32px; color: var(--neutral-400);"></i>
          </div>
          <h6 style="color: var(--neutral-900); margin-bottom: 8px; font-weight: 600;">Nenhum contrato cadastrado</h6>
          <p style="color: var(--neutral-500); margin-bottom: 24px;">Comece adicionando o primeiro contrato</p>
          <%= link_to new_e_contrato_path, class: "btn btn-primary" do %>
            <i data-lucide="plus" style="width: 16px; height: 16px;"></i>
            Novo Contrato
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
<style>
  .page-header-wrapper {
    background: white;
    padding: 16px 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    margin-bottom: -24px;
    position: relative;
    z-index: 1;
  }
</style>
